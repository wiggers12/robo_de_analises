<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rob√¥ Aviator IA v9.5-Final</title>

<!-- Firebase + TensorFlow.js + Chart.js -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<style>
html,body{
  margin:0;padding:0;height:100%;
  background:radial-gradient(circle at 50% 50%,#001f3f,#000);
  font-family:"Poppins",sans-serif;color:#fff;overflow:hidden;
}
iframe{width:100%;height:calc(100vh - 70px);border:none;}

/* Painel lateral */
#painel{
  position:fixed;top:0;left:-420px;width:420px;height:100%;
  background:rgba(0,10,20,0.9);backdrop-filter:blur(10px);
  border-right:1px solid rgba(0,229,255,0.1);
  box-shadow:5px 0 20px rgba(0,229,255,0.2);
  transition:left .4s ease,opacity .4s ease;
  padding:20px;overflow-y:auto;z-index:9999;
  opacity:0;visibility:hidden;
}
#painel.aberto{left:0;opacity:1;visibility:visible;}
#btnFecharPainel{
  position:fixed;top:15px;left:15px;background:rgba(0,0,0,0.6);
  color:#fff;border:none;font-size:20px;border-radius:50%;
  width:40px;height:40px;cursor:pointer;z-index:10001;
  box-shadow:0 0 10px rgba(0,229,255,0.5);
}
#btnFecharPainel:hover{background:#ff1744;}
h2{text-align:center;color:#00e5ff;margin-top:50px;}

/* Hist√≥rico em grade */
#cardsContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap: 10px;
  margin-top: 10px;
}
.card {
  border-radius: 10px;
  text-align: center;
  padding: 8px 0;
  font-weight: bold;
  font-size: 15px;
  box-shadow: 0 0 10px rgba(0,229,255,0.15);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(0,229,255,0.4);
}
.card.alta {background: linear-gradient(135deg,#ff66cc,#660033);}
.card.media {background: linear-gradient(135deg,#a020f0,#260046);}
.card.baixa {background: linear-gradient(135deg,#007bff,#001f3f);}

/* Painel IA */
#iaContainer{
  margin-top:25px;background:rgba(0,0,0,0.3);
  border-radius:10px;padding:15px;
  box-shadow:0 0 10px rgba(0,229,255,0.2);
}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:15px;}
.stat-card{
  background:#0c192c;padding:10px;border-radius:8px;text-align:center;
  box-shadow:0 0 8px rgba(0,229,255,0.2);
}
.stat-card h4{margin:0;color:#00e5ff;font-size:14px;}
.stat-card p{margin:4px 0 0;font-size:16px;font-weight:bold;}
#recomendacao{
  background:rgba(0,0,0,0.5);padding:10px;margin-top:10px;
  border-radius:10px;text-align:center;font-weight:bold;
  box-shadow:0 0 8px rgba(0,229,255,0.2);
}

/* Rodap√© */
footer{
  position:fixed;bottom:0;left:0;width:100%;height:70px;
  background:rgba(0,0,0,0.9);border-top:1px solid #00e5ff;
  display:flex;justify-content:space-around;align-items:center;
  z-index:20000;
}
.footer-btn{color:#bbb;text-align:center;flex:1;cursor:pointer;transition:0.3s;font-size:13px;}
.footer-btn span{display:block;font-size:22px;margin-bottom:4px;}
.footer-btn.active{color:#00e5ff;text-shadow:0 0 10px #00e5ff;}
.footer-btn:hover{color:#00e676;}

/* Chat flutuante */
#chatWindow{
  display:none;position:fixed;bottom:90px;left:20px;
  width:320px;height:420px;background:rgba(0,0,20,0.95);
  border-radius:12px;box-shadow:0 0 20px rgba(0,229,255,0.4);
  display:flex;flex-direction:column;z-index:20001;overflow:hidden;
}
#chatHeader{background:#00bcd4;padding:10px;color:#000;font-weight:bold;text-align:center;position:relative;}
#closeChat{position:absolute;right:10px;top:6px;cursor:pointer;font-weight:bold;}
#clearChat{position:absolute;left:10px;top:6px;font-size:13px;cursor:pointer;}
#chatMessages{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:6px;}
.msg{max-width:80%;padding:8px 10px;border-radius:10px;word-wrap:break-word;}
.msg.user{align-self:flex-end;background:#007bff;}
.msg.bot{align-self:flex-start;background:#004d80;border:1px solid #00e5ff;}
#chatInputContainer{display:flex;border-top:1px solid #00e5ff;}
#chatInput{flex:1;background:transparent;border:none;padding:10px;color:white;outline:none;}
#chatSend{background:#00e5ff;border:none;color:#000;padding:8px 15px;cursor:pointer;font-weight:bold;}

/* Previs√£o IA */
.previsao-card {
  border-radius: 10px;
  color: #fff;
  font-weight: bold;
  font-size: 15px;
  text-align: center;
  padding: 10px 15px;
  animation: brilhoPulse 2s infinite ease-in-out;
  box-shadow: 0 0 12px rgba(255, 102, 204, 0.4);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.previsao-card:hover {
  transform: scale(1.08);
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
}
@keyframes brilhoPulse {
  0% { box-shadow: 0 0 6px rgba(255,255,255,0.3); }
  50% { box-shadow: 0 0 18px rgba(255,255,255,0.9); }
  100% { box-shadow: 0 0 6px rgba(255,255,255,0.3); }
}

/* üí° Dicas da IA */
#dicasWindow{
  display:none;
  position:fixed;
  bottom:90px;right:20px;
  width:340px;height:420px;
  background:rgba(0,10,20,0.95);
  border-radius:12px;
  box-shadow:0 0 20px rgba(0,229,255,0.4);
  color:#fff;
  overflow:hidden;
  flex-direction:column;
  z-index:20005;
}
#dicasHeader{
  background:#00bcd4;
  color:#000;
  padding:10px;
  font-weight:bold;
  text-align:center;
  position:relative;
  font-size:15px;
}
#closeDicas{
  position:absolute;
  right:10px;top:6px;
  cursor:pointer;
  font-weight:bold;
}
#dicasContent{
  padding:10px;
  font-size:14px;
  overflow-y:auto;
  height:calc(100% - 40px);
  display:flex;
  flex-direction:column;
  gap:10px;
}
.dicaCard{
  background:rgba(0,229,255,0.08);
  border-left:4px solid #00e5ff;
  border-radius:8px;
  padding:8px 10px;
  line-height:1.4;
  box-shadow:0 0 8px rgba(0,229,255,0.2);
  animation:fadeIn 0.4s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px);}
  to{opacity:1;transform:translateY(0);}
}
</style>
</head>
<body>
<iframe src="https://rn72q.com/main/inicio?pid=575973404"></iframe>

<div id="painel">
  <button id="btnFecharPainel">‚ùå</button>
  <h2>√öltimos Resultados</h2>
  <div id="cardsContainer"></div>

  <div id="iaContainer" style="display:none;">
    <h3>üß† Previs√£o IA</h3>
    <canvas id="graficoVelas" height="120"></canvas>
    <div class="stats">
      <div class="stat-card"><h4>M√©dia</h4><p id="mediaValor">-</p></div>
      <div class="stat-card"><h4>M√°ximo</h4><p id="maxValor">-</p></div>
      <div class="stat-card"><h4>M√≠nimo</h4><p id="minValor">-</p></div>
      <div class="stat-card"><h4>Tend√™ncia</h4><p id="tendencia">-</p></div>
    </div>
    <canvas id="graficoIA"></canvas>
    <p id="iaProbText">Treinando IA...</p>
    <div id="recomendacao">Analisando mercado...</div>
  </div>
</div>

<footer>
  <div class="footer-btn" id="btnResultados"><span>üìú</span>Resultados</div>
  <div class="footer-btn" id="btnIA"><span>üß†</span>IA</div>
  <div class="footer-btn" id="btnChat"><span>ü§ñ</span>Chat</div>
  <div class="footer-btn" id="btnConfig"><span>‚öôÔ∏è</span>Config</div>
</footer>

<!-- Chat flutuante -->
<div id="chatWindow">
  <div id="chatHeader">
    Chat com IA
    <span id="clearChat">üóë</span>
    <span id="closeChat">‚úñ</span>
  </div>
  <div id="chatMessages"></div>
  <div id="chatInputContainer">
    <input type="text" id="chatInput" placeholder="Digite sua pergunta...">
    <button id="chatSend">Enviar</button>
  </div>
</div>

<!-- üí° DICAS DA IA -->
<div id="dicasWindow">
  <div id="dicasHeader">
    üí° Dicas da IA
    <span id="closeDicas">‚úñ</span>
  </div>
  <div id="dicasContent"></div>
</div>

<script>
/* === CONFIGURA√á√ÉO FIREBASE === */
const firebaseConfig={
  apiKey:"AIzaSyD-yt8AmgRkMnJH9xKwDSKn9_X42Cmpq7Y",
  authDomain:"robo-aviator2025.firebaseapp.com",
  projectId:"robo-aviator2025",
  storageBucket:"robo-aviator2025.firebasestorage.app",
  messagingSenderId:"303072216239",
  appId:"1:303072216239:web:d6e659c5dd49be14e7005a"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

/* === VARI√ÅVEIS GLOBAIS === */
const painel=document.getElementById("painel"),
fechar=document.getElementById("btnFecharPainel"),
cardsContainer=document.getElementById("cardsContainer"),
iaContainer=document.getElementById("iaContainer"),
iaText=document.getElementById("iaProbText");
let graficoIA=null,graficoVelas=null,historicoCache=[],unsubscribe=null;
let somAlerta=new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_1b7c5c241d.mp3?filename=notification-1-126517.mp3");

/* === FIREBASE HIST√ìRICO === */
function conectarFirebase(){
  if(unsubscribe) unsubscribe();
  unsubscribe = db.collection("historico").orderBy("timestamp","desc").limit(50).onSnapshot(snap => {

    const novos = [];
    snap.forEach(doc => {
      const d = doc.data();
      const v = parseFloat(d.valor || d.resultado || "0");
      novos.unshift(v);
    });

    // üî• Mant√©m hist√≥rico anterior e adiciona apenas os novos valores
    if (historicoCache.length > 0) {
      const ultimoAntigo = historicoCache[historicoCache.length - 1];
      const ultimoNovo = novos[novos.length - 1];
      if (ultimoAntigo !== ultimoNovo) {
        historicoCache = [...historicoCache, ...novos];
      }
    } else {
      historicoCache = novos;
    }

    // Atualiza visual dos cards (m√°ximo 50 √∫ltimos)
    cardsContainer.innerHTML = "";
    historicoCache.slice(-50).forEach(v => {
      const c = v >= 10.01 ? "alta" : v >= 2.01 ? "media" : "baixa";
      const el = document.createElement("div");
      el.className = `card ${c}`;
      el.innerHTML = `<div>${v.toFixed(2)}x</div>`;
      cardsContainer.appendChild(el);
    });

    // Atualiza IA e gr√°ficos
    if (historicoCache.length > 0) {
      atualizarPainelIA(historicoCache);
      treinarIA(historicoCache);
    }
  });
}
conectarFirebase();

/* === CONTROLE PAINEL / RODAP√â === */
const btnResultados=document.getElementById("btnResultados");
const btnIA=document.getElementById("btnIA");
const btnChat=document.getElementById("btnChat");
const btnConfig=document.getElementById("btnConfig");
btnResultados.onclick=()=>{painel.classList.add("aberto");cardsContainer.style.display="grid";iaContainer.style.display="none";};
btnIA.onclick=()=>{painel.classList.add("aberto");cardsContainer.style.display="none";iaContainer.style.display="block";};
btnChat.onclick=()=>{document.getElementById("chatWindow").style.display="flex";};
btnConfig.onclick=()=>alert("‚öôÔ∏è Configura√ß√µes em desenvolvimento.");
fechar.onclick=()=>painel.classList.remove("aberto");

/* === PAINEL IA === */
function atualizarPainelIA(v){
 if(v.length<3)return;
 const media=(v.reduce((a,b)=>a+b,0)/v.length).toFixed(2);
 const max=Math.max(...v).toFixed(2);
 const min=Math.min(...v).toFixed(2);
 document.getElementById("mediaValor").innerText=media+"x";
 document.getElementById("maxValor").innerText=max+"x";
 document.getElementById("minValor").innerText=min+"x";
 const tendencia=v[v.length-1]>v[v.length-2]?"Alta":v[v.length-1]<2?"Baixa":"Est√°vel";
 document.getElementById("tendencia").innerText=tendencia;
 atualizarGraficoVelas(v);
}

/* === GR√ÅFICO VELAS === */
function atualizarGraficoVelas(valores){
 const ctx=document.getElementById("graficoVelas").getContext("2d");
 if(graficoVelas)graficoVelas.destroy();
 const ultimos=valores.slice(-60);
 const cores=ultimos.map(v=>v>=10.01?"#ff66cc":v>=2.01?"#a020f0":"#007bff");
 graficoVelas=new Chart(ctx,{type:"bar",data:{labels:ultimos.map((_,i)=>i+1),datasets:[{data:ultimos,backgroundColor:cores}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});
}

/* === IA PREDITIVA === */
async function treinarIA(v){
  if(v.length<30)return;
  const xs=[],ys=[];
  for(let i=0;i<v.length-30;i++){xs.push(v.slice(i,i+30));ys.push(v[i+30]);}
  const input=tf.tensor2d(xs),out=tf.tensor2d(ys,[ys.length,1]);
  const model=tf.sequential();
  model.add(tf.layers.dense({units:32,activation:"relu",inputShape:[30]}));
  model.add(tf.layers.dense({units:16,activation:"relu"}));
  model.add(tf.layers.dense({units:1}));
  model.compile({optimizer:"adam",loss:"meanSquaredError"});
  await model.fit(input,out,{epochs:25,batchSize:16,verbose:0});
  const base=[...v];const previsoes=[];
  for(let i=0;i<5;i++){
    const pred=model.predict(tf.tensor2d([base.slice(-30)]));
    const val=(await pred.data())[0];previsoes.push(val);base.push(val);
  }
  mostrarProb(model,v,previsoes);
}

function mostrarProb(model,v,previsoes){
 const media=(v.reduce((a,b)=>a+b,0)/v.length).toFixed(2);
 const max=Math.max(...v).toFixed(2);
 const min=Math.min(...v).toFixed(2);
 const tendencia=v[v.length-1]>v[v.length-2]?"Alta":v[v.length-1]<2?"Baixa":"Est√°vel";
 const ctx1=document.getElementById("graficoIA").getContext("2d");
 if(window.graficoIA1)window.graficoIA1.destroy();
 const ultimos=v.slice(-60);
 const cores=ultimos.map(x=>x>=10.01?"#ff66cc":x>=2.01?"#a020f0":"#007bff");
 window.graficoIA1=new Chart(ctx1,{type:"bar",data:{labels:ultimos.map((_,i)=>i+1),datasets:[{data:ultimos,backgroundColor:cores}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});
 document.getElementById("mediaValor").innerText=media+"x";
 document.getElementById("maxValor").innerText=max+"x";
 document.getElementById("minValor").innerText=min+"x";
 document.getElementById("tendencia").innerText=tendencia;

 const pred=model.predict(tf.tensor2d([v.slice(-30)]));
 pred.data().then(d=>{
  const val=d[0];
  const alta=val>3?0.75:val>=2?0.3:0.1;
  const mediaP=val>=2&&val<=3?0.6:0.2;
  const baixa=val<2?0.8:0.1;
  let conf=0,altas=0,baixas=0;
  let html=`<h3>üîÆ Pr√≥ximas Previs√µes</h3><div style="display:flex;gap:10px;flex-wrap:wrap;">`;
  previsoes.forEach(p=>{
    let tipo="baixa";
    if(p>=2.01 && p<10) tipo="media";
    else if(p>=10.01) tipo="alta";
    const cor=tipo==="alta"?"#ff66cc":tipo==="media"?"#a020f0":"#007bff";
    html+=`<div class="previsao-card" style="background:${cor};">${p.toFixed(2)}x</div>`;
    if(tipo==="alta")altas++;if(tipo==="baixa")baixas++;
    conf+=tipo==="alta"?0.85:tipo==="media"?0.6:0.35;
  });
  conf=(conf/previsoes.length*100).toFixed(1);
  let rec="‚öñÔ∏è Padr√£o neutro, aguarde confirma√ß√£o.";
  if(altas>=3)rec="üî• Boa hora para entrar! Tend√™ncia de alta detectada.";
  else if(baixas>=3)rec="‚ùÑÔ∏è Mercado em baixa, evite entradas agora.";
  document.getElementById("iaProbText").innerHTML=`üéØ Confian√ßa m√©dia: <b>${conf}%</b><br>${rec}<br><br>${html}</div>`;
  if(altas>=3){somAlerta.play();}
 });
}

/* === BOT√ÉO DICAS IA === */
const btnDicas=document.createElement("div");
btnDicas.className="footer-btn";
btnDicas.id="btnDicas";
btnDicas.innerHTML=`<span>üí°</span>Dicas IA`;
document.querySelector("footer").appendChild(btnDicas);

const dicasWindow=document.getElementById("dicasWindow");
const closeDicas=document.getElementById("closeDicas");
const dicasContent=document.getElementById("dicasContent");
btnDicas.onclick=()=>{dicasWindow.style.display="flex";dicasWindow.style.flexDirection="column";};
closeDicas.onclick=()=>dicasWindow.style.display="none";
function adicionarDicaIA(texto){
  const dica=document.createElement("div");
  dica.className="dicaCard";
  dica.innerHTML=texto;
  dicasContent.appendChild(dica);
  dicasContent.scrollTop=dicasContent.scrollHeight;
}

/* === ANALISTA REATIVA === */
let ultimoComentario="";
function interpretarResultado(novoValor,historico){
  if(historico.length<5)return null;
  const ultimos5=historico.slice(-5);
  const media5=(ultimos5.reduce((a,b)=>a+b,0)/ultimos5.length).toFixed(2);
  const tendencia=novoValor>media5?"alta":novoValor<2?"baixa":"neutra";
  const sequenciaAlta=ultimos5.every(v=>v>=3);
  const sequenciaBaixa=ultimos5.every(v=>v<2);
  let comentario="";
  if(sequenciaAlta)comentario=`üìà Mercado aquecido ‚Äî sequ√™ncia de altas acima de 3x (m√©dia ${media5}x).`;
  else if(sequenciaBaixa)comentario=`‚ö†Ô∏è Tend√™ncia de queda ‚Äî sequ√™ncia de baixas abaixo de 2x (m√©dia ${media5}x).`;
  else if(novoValor>10)comentario=`üí• Pico de ${novoValor.toFixed(2)}x detectado ‚Äî poss√≠vel corre√ß√£o nas pr√≥ximas rodadas.`;
  else if(tendencia==="alta")comentario=`üìä Vela ${novoValor.toFixed(2)}x ‚Äî acima da m√©dia (${media5}x). Ind√≠cio de retomada.`;
  else if(tendencia==="baixa")comentario=`üìâ Vela ${novoValor.toFixed(2)}x ‚Äî abaixo da m√©dia (${media5}x). Perda de for√ßa moment√¢nea.`;
  else comentario=`‚öñÔ∏è Mercado est√°vel (${novoValor.toFixed(2)}x). Mantendo padr√£o lateral.`;
  if(comentario!==ultimoComentario){
    ultimoComentario=comentario;
    exibirComentarioPainel(comentario);
    adicionarDicaIA(comentario);
  }
}
function exibirComentarioPainel(texto){
  let painelComentario=document.getElementById("comentarioPainelIA");
  if(!painelComentario){
    painelComentario=document.createElement("div");
    painelComentario.id="comentarioPainelIA";
    painelComentario.style="margin-top:10px;background:rgba(0,0,0,0.6);border-radius:10px;padding:10px;font-size:14px;line-height:1.4;box-shadow:0 0 10px rgba(0,229,255,0.2);color:#00e5ff;";
    document.getElementById("iaContainer").appendChild(painelComentario);
  }
  painelComentario.innerHTML=texto;
}

/* === INTEGRA√á√ÉO AUTOM√ÅTICA COM FIREBASE (CORRIGIDA) === */
let ultimoTimestamp = null;

db.collection("historico")
  .orderBy("timestamp", "desc")
  .limit(50)
  .onSnapshot((snap) => {
    snap.docChanges().forEach((change) => {
      if (change.type === "added") {
        const d = change.doc.data();
        const novoValor = parseFloat(d.valor || d.resultado || "0");
        const ts = d.timestamp ? d.timestamp.toMillis() : Date.now();

        // Evita repetir o mesmo resultado
        if (!ultimoTimestamp || ts !== ultimoTimestamp) {
          ultimoTimestamp = ts;
          interpretarResultado(novoValor, historicoCache);
        }
      }
    });
  });

/* === CHAT IA === */
const chatWindow=document.getElementById("chatWindow"),
chatInput=document.getElementById("chatInput"),
chatSend=document.getElementById("chatSend"),
chatMessages=document.getElementById("chatMessages"),
closeChat=document.getElementById("closeChat"),
clearChat=document.getElementById("clearChat");
closeChat.onclick=()=>{chatWindow.style.display="none";};
clearChat.onclick=()=>{chatMessages.innerHTML="";localStorage.removeItem("chatHistory");};
chatSend.onclick=()=>sendMsg();
chatInput.addEventListener("keypress",e=>{if(e.key==="Enter")sendMsg();});
function sendMsg(){
  const t=chatInput.value.trim();
  if(!t)return;
  addUserMsg(t);
  chatInput.value="";
  addBotTyping();
  setTimeout(()=>{
    const r=gerarRespostaIA(t);
    removeBotTyping();
    typeBotMsg(r);
  },800+Math.random()*700);
}
function addUserMsg(t){
  const d=document.createElement("div");
  d.className="msg user";
  d.textContent=t;
  chatMessages.appendChild(d);
  chatMessages.scrollTop=chatMessages.scrollHeight;
  saveHistory();
}
function typeBotMsg(text){
  const wrap=document.createElement("div");
  wrap.className="msg bot";
  chatMessages.appendChild(wrap);
  chatMessages.scrollTop=chatMessages.scrollHeight;
  let i=0;
  const interval=setInterval(()=>{
    wrap.textContent=text.slice(0,i);
    chatMessages.scrollTop=chatMessages.scrollHeight;
    i++;
    if(i>text.length){clearInterval(interval);saveHistory();}
  },25);
}
function addBotTyping(){
  const typing=document.createElement("div");
  typing.id="typing";
  typing.className="msg bot";
  typing.innerHTML="üí¨ Digitando...";
  chatMessages.appendChild(typing);
  chatMessages.scrollTop=chatMessages.scrollHeight;
}
function removeBotTyping(){
  const t=document.getElementById("typing");
  if(t)t.remove();
}
function gerarRespostaIA(q){
  const u=historicoCache[historicoCache.length-1]||0;
  const m=(historicoCache.reduce((a,b)=>a+b,0)/(historicoCache.length||1)).toFixed(2);
  const tendencia=u>m?"alta":u<2?"baixa":"neutra";
  const recomendacao=document.getElementById("recomendacao")?document.getElementById("recomendacao").innerText:"Analisando mercado...";
  q=q.toLowerCase();
  if(q.includes("m√©dia"))return`üìä M√©dia atual ${m}x (${tendencia}).`;
  if(q.includes("√∫ltimo"))return`üìà √öltimo resultado ${u.toFixed(2)}x (${u>m?"acima":"abaixo"} da m√©dia).`;
  if(q.includes("tend√™ncia"))return tendencia==="alta"?"üî• Alta em curso!":"‚öñÔ∏è Padr√£o lateral, aguarde.";
  if(q.includes("recomendar")||q.includes("entrar"))return recomendacao;
  if(q.includes("ajuda"))return"üß† Posso te informar m√©dias, tend√™ncias e previs√µes. Pergunte!";
  return`ü§ñ M√©dia ${m}x, √∫ltimo ${u}x, tend√™ncia ${tendencia}.`;
}
function saveHistory(){try{localStorage.setItem("chatHistory",chatMessages.innerHTML);}catch{localStorage.removeItem("chatHistory");}}
window.onload=()=>{try{const s=localStorage.getItem("chatHistory");if(s)chatMessages.innerHTML=s;}catch{}};
</script>
</body>
</html>
