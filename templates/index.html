<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RobÃ´ de AnÃ¡lises - Aviator</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: white;
    }

    iframe {
      width: 100%;
      height: 100vh;
      border: none;
    }

    #botaoFlutuante {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background-color: #00bcd4;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 15px 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      z-index: 9999;
    }

    #botaoFlutuante:hover {
      background-color: #0097a7;
      transform: scale(1.05);
    }

    #painel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100%;
      background-color: #1a1a1a;
      box-shadow: -4px 0 10px rgba(0,0,0,0.5);
      transition: right 0.4s ease-in-out;
      padding: 20px;
      overflow-y: auto;
      z-index: 10000;
    }

    #painel.aberto {
      right: 0;
    }

    #painel h2 {
      text-align: center;
      color: #00bcd4;
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border-bottom: 1px solid #333;
      padding: 8px;
      text-align: center;
    }

    tr:nth-child(even) {
      background: #222;
    }

    #media {
      margin-top: 10px;
      text-align: center;
      font-size: 18px;
      color: #00e676;
    }

    #fecharPainel {
      background: #ff1744;
      border: none;
      color: white;
      padding: 8px 12px;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 10px;
    }

    #tendencia {
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
      color: #ffeb3b;
    }
  </style>

  <!-- Firebase SDK compatÃ­vel -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
</head>

<body>

  <!-- Aviator embutido -->
  <iframe src="https://big.bet.br/casino/game/3496406?provider=Spribe&from=%2Fcasino"></iframe>

  <!-- BotÃ£o flutuante -->
  <button id="botaoFlutuante">ðŸ“Š Aguardando leitura...</button>

  <!-- Painel lateral -->
  <div id="painel">
    <button id="fecharPainel">Fechar âœ–</button>
    <h2>Ãšltimos Resultados</h2>
    <table id="tabela">
      <tr><th>#</th><th>Valor</th><th>Hora</th></tr>
    </table>
    <p id="media">MÃ©dia: --</p>
    <p id="tendencia"></p>
  </div>

  <script>
    // ðŸ”¥ ConfiguraÃ§Ã£o do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD-yt8AmgRkMnJH9xKwDSKn9_X42Cmpq7Y",
      authDomain: "robo-aviator2025.firebaseapp.com",
      projectId: "robo-aviator2025",
      storageBucket: "robo-aviator2025.firebasestorage.app",
      messagingSenderId: "303072216239",
      appId: "1:303072216239:web:d6e659c5dd49be14e7005a",
      measurementId: "G-094LT3104Y"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const botao = document.getElementById('botaoFlutuante');
    const painel = document.getElementById('painel');
    const tabela = document.getElementById('tabela');
    const mediaEl = document.getElementById('media');
    const tendenciaEl = document.getElementById('tendencia');
    const fechar = document.getElementById('fecharPainel');

    // ðŸ“¡ Atualiza o botÃ£o com o Ãºltimo resultado
    db.collection("resultados").doc("ultimo").onSnapshot(doc => {
      if (doc.exists) {
        const data = doc.data();
        const valor = parseFloat(data.valor.toString().replace(/"/g, '').trim());
        botao.innerText = `ðŸ“ˆ Ãšltima leitura: ${valor.toFixed(2)}x`;
        botao.style.background = valor >= 2 ? "#4CAF50" : "#F44336";
      } else {
        botao.innerText = "âŒ Nenhum dado encontrado";
        botao.style.background = "#FF5722";
      }
    });

    // ðŸ§­ Ao clicar â†’ abre painel e mostra histÃ³rico
    botao.onclick = async () => {
      painel.classList.toggle('aberto');
      tabela.innerHTML = "<tr><th>#</th><th>Valor</th><th>Hora</th></tr>";

      const docs = await db.collection("historico")
        .orderBy("timestamp", "desc")
        .limit(15)
        .get();

      let soma = 0, cont = 0, acima2 = 0;

      docs.forEach((doc, i) => {
        const d = doc.data();
        const val = parseFloat(d.valor.toString().replace(/"/g, '').trim());
        const hora = d.hora || "--";
        if (!isNaN(val)) {
          soma += val;
          cont++;
          if (val >= 2) acima2++;
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${i + 1}</td><td>${isNaN(val) ? '-' : val.toFixed(2)}x</td><td>${hora}</td>`;
        tabela.appendChild(tr);
      });

      if (cont > 0) {
        const media = (soma / cont).toFixed(2);
        mediaEl.innerText = `ðŸ“Š MÃ©dia das Ãºltimas ${cont}: ${media}x`;
        const tendencia = acima2 / cont;
        tendenciaEl.innerText =
          tendencia > 0.6 ? "ðŸ”® TendÃªncia: Alta (boas entradas)" :
          tendencia > 0.3 ? "âš–ï¸ TendÃªncia neutra" :
          "âš ï¸ TendÃªncia de queda";
      } else {
        mediaEl.innerText = "Sem dados recentes.";
        tendenciaEl.innerText = "";
      }
    };

    fechar.onclick = () => painel.classList.remove("aberto");
  </script>
</body>
</html>
